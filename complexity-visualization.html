<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>Membrane Transport Complexity Graph</title>
  <style>
    html, body {
      margin: 0;
      height: 100%;
      background: #f7f8fa;
      font-family: "Helvetica Neue", Arial, sans-serif;
    }

    #graph {
      width: 100%;
      height: 100%;
    }

    svg {
      width: 100%;
      height: 100%;
    }

    .link {
      stroke: #b0b7c3;
      stroke-width: 2px;
      opacity: 0.8;
    }

    .node circle {
      stroke-width: 2.5px;
    }

    .node rect {
      fill: rgba(255, 255, 255, 0.3);
      stroke: none;
      rx: 6px;
      ry: 6px;
    }

    .node text {
      pointer-events: none;
      font-size: 13px;
      font-weight: 600;
      text-anchor: middle;
      dominant-baseline: middle;
      fill: #1f252f;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/d3@7/dist/d3.min.js"></script>
</head>
<body>
<div id="graph"></div>
<script>
  /* eslint-disable */
  const width = window.innerWidth;
  const height = window.innerHeight;

  const groups = {
    'View': '#f9a97d',
    'Model Group': '#6ec6ff',
    'PhET-iO': '#8dd3c7',
    'A11y': '#d4b6ff'
  };

  const nodeSizes = {
    'Visual Design': 21,
    'Alt-Input': 12,
    'Group Highlighting': 5,
    'Mouse/Touch': 7,
    'Interactive Highlights': 6,
    'Pan/Zoom': 4,
    'Model': 8,
    'Sonification': 4,
    'PhET-iO Instrumentation': 10,
    'PhET-iO State': 8,
    'PhET-iO Dynamic Layout': 4,
    'Preferences': 3,
    'Query Parameters': 2,
    'Description Tier 1+2': 11,
    'Voicing': 5,
    'i18n': 4,
    'i18n Dynamic Layout': 5
  };

  const nodes = [
    { id: 'Visual Design', group: 'View' },
    { id: 'Alt-Input', group: 'View' },
    { id: 'Group Highlighting', group: 'View' },
    { id: 'Mouse/Touch', group: 'View' },
    { id: 'Interactive Highlights', group: 'View' },
    { id: 'Pan/Zoom', group: 'View' },
    { id: 'Model', group: 'Model Group' },
    { id: 'Sonification', group: 'Model Group' },
    { id: 'PhET-iO Instrumentation', group: 'PhET-iO' },
    { id: 'PhET-iO State', group: 'PhET-iO' },
    { id: 'PhET-iO Dynamic Layout', group: 'PhET-iO' },
    { id: 'Preferences', group: 'Model Group' },
    { id: 'Query Parameters', group: 'Model Group' },
    { id: 'Description Tier 1+2', group: 'A11y' },
    { id: 'Voicing', group: 'A11y' },
    { id: 'i18n', group: 'A11y' },
    { id: 'i18n Dynamic Layout', group: 'A11y' }
  ];

  const radiusAdjustments = {
    'Visual Design': 1.2,
    'Alt-Input': 1.5,
    'Description Tier 1+2': 1.4
  };

  nodes.forEach( node => {
    node.value = nodeSizes[ node.id ] || 1;
    node.adjustedValue = node.value * ( radiusAdjustments[ node.id ] || 1 );
    node.color = groups[ node.group ] || '#ccc';
    if ( node.id === 'Sonification' ) {
      node.color = '#f9a97d';
    }
  } );

  const links = [
    [ 'Visual Design', 'Model' ],
    [ 'Model', 'PhET-iO Instrumentation' ],
    [ 'Model', 'PhET-iO State' ],
    [ 'PhET-iO Instrumentation', 'PhET-iO State' ],
    [ 'Model', 'Description Tier 1+2' ],
    [ 'Model', 'Sonification' ],
    [ 'Model', 'Mouse/Touch' ],
    [ 'Visual Design', 'Mouse/Touch' ],
    [ 'Visual Design', 'Alt-Input' ],
    [ 'Visual Design', 'Interactive Highlights' ],
    [ 'Visual Design', 'Pan/Zoom' ],
    [ 'Mouse/Touch', 'Pan/Zoom' ],
    [ 'Alt-Input', 'Group Highlighting' ],
    [ 'Group Highlighting', 'Interactive Highlights' ],
    [ 'Interactive Highlights', 'Alt-Input' ],
    [ 'Interactive Highlights', 'Mouse/Touch' ],
    [ 'Alt-Input', 'Mouse/Touch' ],
    [ 'Alt-Input', 'Description Tier 1+2' ],
    [ 'Alt-Input', 'Pan/Zoom' ],
    [ 'Description Tier 1+2', 'Voicing' ],
    [ 'Description Tier 1+2', 'Preferences' ],
    [ 'Description Tier 1+2', 'i18n' ],
    [ 'Description Tier 1+2', 'Interactive Highlights' ],
    [ 'Description Tier 1+2', 'Visual Design' ],
    [ 'Voicing', 'i18n' ],
    [ 'Voicing', 'Preferences' ],
    [ 'Sonification', 'Preferences' ],
    [ 'i18n', 'Query Parameters' ],
    [ 'i18n', 'i18n Dynamic Layout' ],
    [ 'i18n', 'PhET-iO Instrumentation' ],
    [ 'i18n Dynamic Layout', 'Visual Design' ],
    [ 'PhET-iO Dynamic Layout', 'PhET-iO Instrumentation' ],
    [ 'PhET-iO Instrumentation', 'Preferences' ],
    [ 'PhET-iO Instrumentation', 'Query Parameters' ],
    [ 'Preferences', 'PhET-iO State' ],
    [ 'Query Parameters', 'Preferences' ]
  ].map( ( [ source, target ] ) => ( { source: source, target: target } ) );
  /* eslint-disable */
  const svg = d3.select( '#graph' ).append( 'svg' );

  const radiusScale = d3.scaleSqrt()
    .domain( d3.extent( nodes, d => d.adjustedValue ) )
    .range( [ 26, 56 ] );

  const link = svg.append( 'g' )
    .attr( 'stroke-linecap', 'round' )
    .selectAll( 'line' )
    .data( links )
    .enter()
    .append( 'line' )
    .attr( 'class', 'link' );

  const node = svg.append( 'g' )
    .attr( 'stroke-linecap', 'round' )
    .selectAll( '.node' )
    .data( nodes )
    .enter()
    .append( 'g' )
    .attr( 'class', 'node' )
    .call( d3.drag()
      .on( 'start', dragstarted )
      .on( 'drag', dragged )
      .on( 'end', dragended ) );

  node.append( 'circle' )
    .attr( 'fill', d => d.color )
    .attr( 'stroke', d => d3.color( d.color ).darker() )
    .attr( 'r', d => radiusScale( d.adjustedValue ) );

  const textPadding = 6;

  const text = node.append( 'text' )
    .attr( 'dy', '0.35em' )
    .text( d => d.id );

  text.each( function( d ) {
    const bbox = this.getBBox();
    d.textWidth = bbox.width;
    d.textHeight = bbox.height;
  } );

  node.insert( 'rect', 'text' )
    .attr( 'width', d => ( d.textWidth || 0 ) + textPadding * 2 )
    .attr( 'height', d => ( d.textHeight || 0 ) + textPadding * 2 )
    .attr( 'x', d => -( ( d.textWidth || 0 ) / 2 ) - textPadding )
    .attr( 'y', d => -( ( d.textHeight || 0 ) / 2 ) - textPadding );

  const simulation = d3.forceSimulation( nodes )
    .force( 'link', d3.forceLink( links ).id( d => d.id ).distance( 160 ).strength( 0.5 ) )
    .force( 'charge', d3.forceManyBody().strength( -800 ) )
    .force( 'center', d3.forceCenter( width / 2, height / 2 ) )
    .force( 'collide', d3.forceCollide().radius( d => radiusScale( d.adjustedValue ) + 10 ) )
    .on( 'tick', ticked );

  window.addEventListener( 'resize', () => {
    const w = window.innerWidth;
    const h = window.innerHeight;
    svg.attr( 'width', w ).attr( 'height', h );
    simulation.force( 'center', d3.forceCenter( w / 2, h / 2 ) ).alpha( 0.3 ).restart();
  } );

  svg.attr( 'width', width ).attr( 'height', height );

  function ticked() {
    link
      .attr( 'x1', d => d.source.x )
      .attr( 'y1', d => d.source.y )
      .attr( 'x2', d => d.target.x )
      .attr( 'y2', d => d.target.y );

    node.attr( 'transform', d => `translate(${d.x},${d.y})` );
  }

  function dragstarted( event, d ) {
    if ( !event.active ) {simulation.alphaTarget( 0.3 ).restart();}
    d.fx = d.x;
    d.fy = d.y;
  }

  function dragged( event, d ) {
    d.fx = event.x;
    d.fy = event.y;
  }

  function dragended( event, d ) {
    if ( !event.active ) {simulation.alphaTarget( 0 );}
    d.fx = null;
    d.fy = null;
  }
</script>
</body>
</html>
